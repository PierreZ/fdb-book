<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>the FoundationDB Book</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="welcome.html">The FoundationDB Book</a></li><li class="chapter-item expanded affix "><li class="part-title">Meet FoundationDB</li><li class="chapter-item expanded "><a href="meet_fdb/another_db.html"><strong aria-hidden="true">1.</strong> Yet another database?</a></li><li class="chapter-item expanded "><a href="meet_fdb/enter_fdb.html"><strong aria-hidden="true">2.</strong> Enter FoundationDB</a></li><li class="chapter-item expanded "><a href="meet_fdb/everything_is_kv.html"><strong aria-hidden="true">3.</strong> Everything is a key-value!</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> TODO: Correct and robust, choose both</div></li><li class="chapter-item expanded affix "><li class="part-title">Getting started with FoundationDB</li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> TODO: Installing FoundationDB</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> TODO: Using fdbcli</div></li><li class="chapter-item expanded affix "><li class="part-title">Common Programming concepts</li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> TODO: Transaction</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> TODO: Row-key</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> TODO: Tuple</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> TODO: Subspace</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.</strong> TODO: Directory</div></li><li class="chapter-item expanded affix "><li class="part-title">Developing a layer</li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.</strong> TODO: designs</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.</strong> TODO: tips and tricks</div></li><li class="chapter-item expanded affix "><li class="part-title">FoundationDB's internals</li><li class="chapter-item expanded "><div><strong aria-hidden="true">14.</strong> TODO: the list of roles</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.</strong> TODO: the write-path</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.</strong> TODO: the read-path</div></li><li class="chapter-item expanded affix "><li class="part-title">The Record-Layer</li><li class="chapter-item expanded "><div><strong aria-hidden="true">17.</strong> TODO: What is the Record-layer?</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">18.</strong> TODO: QuiCK</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
<script defer data-domain="pierrez.github.io/fdb-book" src="https://plausible.io/js/plausible.js"></script>
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">the FoundationDB Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/PierreZ/fdb-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="the-foundationdbs-book-"><a class="header" href="#the-foundationdbs-book-">The FoundationDB's Book 📖</a></h1>
<p>Welcome to FoundationDB's Book! If you are looking to start writing your own datastore with FoundationDB, or if you are curious about FDB, you have come to the right place.</p>
<p>🚧 This is currently a work-in-progress, feel free to <a href="https://github.com/PierreZ/fdb-book">contribute</a> chapters! 🚧</p>
<h2 id="what-this-book-covers"><a class="header" href="#what-this-book-covers">What This Book Covers</a></h2>
<p>This book aims to be a comprehensive, up-to-date guide to use FoundationDB features and libraries, appropriate for beginners and old hands alike. It is also designed to be an entrypoint towards the FoundationDB's community. This is definitely not designed as a replacement for the <a href="https://apple.github.io/foundationdb/">official documentation</a> or the <a href="https://forums.foundationdb.org/">forum</a>.</p>
<ul>
<li>The early chapters provide an introduction to FoundationDB, why it may interest you, and what is a layer.</li>
<li>The Record-Layer chapter is focusing on the Record-Layer, a Java library to write layers made by Apple.</li>
<li>The middle chapters discuss key utilities and features provided by the bindings, and describe best-practises to write layers to maximize performance and scalability.</li>
<li>The last chapters are describing core elements of FoundationDB, such as read/write path, or the simulation framework.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="yet-another-database"><a class="header" href="#yet-another-database">Yet another database?</a></h1>
<ul>
<li><a href="meet_fdb/another_db.html#how-to-choose-a-database">How to choose a database?</a></li>
<li><a href="meet_fdb/another_db.html#stateless-applications">Stateless applications</a></li>
<li><a href="meet_fdb/another_db.html#datastores-architecture">Datastore's architecture</a></li>
<li><a href="meet_fdb/another_db.html#sharing-the-storage-engine-">Sharing the storage engine 🤔</a></li>
<li><a href="meet_fdb/another_db.html#requirements-for-such-a-storage-engine">Requirements for such a storage engine</a></li>
</ul>
<blockquote>
<p>Another database? There is so many of them 😑</p>
</blockquote>
<p>You are right, we are living in the golden age of data, and as such, we have many options to store our data.</p>
<p>According to the <a href="https://dbdb.io/">Database of Databases</a>, you can choose between <strong>795 database management systems</strong>. Yes, you read it right, almost 800 different databases to compare 😱</p>
<h2 id="how-to-choose-a-database"><a class="header" href="#how-to-choose-a-database">How to choose a database?</a></h2>
<p>If you click on the <a href="https://dbdb.io/browse">Browse button</a>, you will be able to go through the different criteria:</p>
<ul>
<li>is it open-source or not?</li>
<li>is it an embedded/single-node/distributed database?</li>
<li>What is the query language?</li>
<li>is it suited for <a href="https://en.wikipedia.org/wiki/Online_transaction_processing">OTLP</a> or <a href="https://en.wikipedia.org/wiki/Online_analytical_processing">OLAP</a> workloads?</li>
<li>What is the data model?</li>
<li>What is the scalability limits?</li>
<li>Is it transactional?</li>
<li>Is there indexes?</li>
<li>Is it a row-oriented storage, or maybe columnar?</li>
<li>is there stored procedures and materialized views?</li>
<li>and so on.</li>
</ul>
<p>That's a lot of criteria! But that means we also have a big number of possible combinations, each one creating a potential new database. This is why we have <strong>specialized datastores</strong> like:</p>
<ul>
<li>document</li>
<li>column </li>
<li>key-value</li>
<li>graph </li>
<li>indexing</li>
<li>messaging</li>
<li>and others!</li>
</ul>
<h2 id="stateless-applications"><a class="header" href="#stateless-applications">Stateless applications</a></h2>
<p>This variety of specialized datastore is allowing developers to have multiple datastores as <strong>requirements</strong> for a single infrastructure.</p>
<blockquote>
<p>Alice: &quot;Hey Bob, what do you need for your next project?&quot;</p>
<p>Bob: &quot;Mmmmh, I will need an SQL database and a messaging systems 🤔&quot;.</p>
</blockquote>
<p>Storing data is hard, so we are using them as <strong>durable</strong> strongholds for our data, while making our applications mostly <strong>stateless</strong>.</p>
<p>So, Bob's architecture looks like this:</p>
<pre class="mermaid">flowchart TD
    id1(Bob's stateless applications)
    id2(datastore 1)
    id3(datastore 2)
    
    id1 -- uses --&gt; id2
    id1 -- uses --&gt; id3
</pre>
<h2 id="datastores-architecture"><a class="header" href="#datastores-architecture">Datastore's architecture</a></h2>
<p>We said earlier that there is a lot of criteria to choose a database, but we can narrow to 3: </p>
<ul>
<li>What is the <strong>Query language</strong>,</li>
<li>What is the <strong>data model</strong>,</li>
<li>What is the <strong>Storage Engine</strong>.</li>
</ul>
<p>For example, PostgreSQL is exposing relational data through the SQL language and storing files on a single node. </p>
<p>Let's update the flowchart:</p>
<pre class="mermaid">flowchart TD
    id1(Bob's stateless applications)
    ql1(Query Language 1)
    ql2(Query Language 2)
    dm1(Data Model 1)
    dm2(Data Model 2)
    se1(Storage Engine 1)
    se2(Storage Engine 2)
    
    id1 -- uses --&gt; ql1 
    ql1 -- to access data as --&gt; dm1
    dm1 -- which are stored in --&gt; se1
    id1 -- uses --&gt; ql2
    ql2 -- to access data as --&gt; dm2
    dm2 -- which are stored in --&gt; se2
</pre>
<p>Document databases, column-oriented, row-oriented, JSON, key-value, etc. all make sense in the right context, and often different parts of an application call for different choices. That means we cannot mutualize the Query language and the data models. That leaves the storage engine.</p>
<h2 id="sharing-the-storage-engine-"><a class="header" href="#sharing-the-storage-engine-">Sharing the storage engine 🤔</a></h2>
<p>Let's mutualize the storage Engine!</p>
<pre class="mermaid">flowchart TD
    id1(Bob's stateless applications)
    ql1(Query Language 1)
    ql2(Query Language 2)
    dm1(Data Model 1)
    dm2(Data Model 2)
    se(Shared storage Engine)
    
    id1 -- uses --&gt; ql1 
    ql1 -- to access data as --&gt; dm1
    dm1 -- which are stored in --&gt; se
    id1 -- uses --&gt; ql2
    ql2 -- to access data as --&gt; dm2
    dm2 -- which are stored in --&gt; se
</pre>
<p>This design has some great advantages:</p>
<ul>
<li>the storage engine <em>only need to focus</em> on storage,</li>
<li>any components above the storage Engine <strong>has become stateless</strong>.</li>
</ul>
<p>That could work, but if we have put a lot of contraints on the storage engine, let's talk about what we require. </p>
<h2 id="requirements-for-such-a-storage-engine"><a class="header" href="#requirements-for-such-a-storage-engine">Requirements for such a storage engine</a></h2>
<p>So, we know have a storage engines that needs to handle multiple types of data. To be cloud-Native, the storage engine needs to be:</p>
<ul>
<li>fault tolerant,</li>
<li>scalable,</li>
<li>highly available.</li>
</ul>
<p>while providing:</p>
<ul>
<li>strong semantics,</li>
<li>flexible data models.</li>
</ul>
<p>Now the question is: <strong>can we design such a storage engine?</strong> The answer is <strong>yes</strong>, and it is called FoundationDB.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="enter-foundationdb"><a class="header" href="#enter-foundationdb">Enter FoundationDB</a></h1>
<ul>
<li><a href="meet_fdb/enter_fdb.html#foundationdb-as-a-database">FoundationDB as a database</a></li>
<li><a href="meet_fdb/enter_fdb.html#foundationdb-as-a-database-framework">FoundationDB as a database-framework</a></li>
<li><a href="meet_fdb/enter_fdb.html#a-brief-history-of-foundationdb">A brief history of FoundationDB</a></li>
<li><a href="meet_fdb/enter_fdb.html#who-is-using-foundationdb">Who is using FoundationDB?</a></li>
<li><a href="meet_fdb/enter_fdb.html#tldr">TL;DR</a></li>
</ul>
<p>Let's start by quoting the <a href="https://apple.github.io/foundationdb/">official overview</a>:</p>
<blockquote>
<p>FoundationDB is a distributed database designed to handle large volumes of structured data across clusters of commodity servers. It organizes data as an ordered key-value store and employs ACID transactions for all operations. It is especially well-suited for read/write workloads but also has excellent performance for write-intensive workloads.</p>
</blockquote>
<p>FoundationDB is an open-source(Apache V2), distributed key-value store written in Flow, an async-first language that targets C++ specially developed for the database. </p>
<p>Like all key-value stores, it looks like an infinite dictionary/map from programming, allowing you to store key and values in bytes. </p>
<p>Keys are lexicographic order, which means:</p>
<ul>
<li><code>'0'</code> is sorted before <code>'1'</code></li>
<li><code>'apple'</code> is sorted before <code>'banana'</code></li>
<li><code>'apple'</code> is sorted before <code>'apple123'</code></li>
<li>keys starting with <code>'mytable\'</code> are sorted together (e.g. <code>'mytable\row1'</code>, <code>'mytable\row2'</code>, ...)</li>
</ul>
<p>One huge advantage of FDB is that it supports <strong>multi-key strictly serializable transactions</strong>. Let's break-down the words in reverse order:</p>
<ul>
<li><strong>transactions</strong>: All reads and writes in FoundationDB are accomplished using transactions. These transactions are fully ACID (Atomic, Consistent, Isolated, and Durable) and span across multiple machines with high performance.</li>
<li><strong>Serializable</strong>: this means that the outcome of concurrent transaction is equal to a serial execution.</li>
<li><strong>Strictly</strong>: transactions are strictly ordered</li>
<li><strong>Multi-key</strong>: you can write across regions/shards</li>
</ul>
<p>The full list of features is available <a href="https://apple.github.io/foundationdb/features.html">here</a>, and you will also finds a <a href="https://apple.github.io/foundationdb/anti-features.html">anti-features list</a>.</p>
<h2 id="foundationdb-as-a-database"><a class="header" href="#foundationdb-as-a-database">FoundationDB as a database</a></h2>
<p>FoundationDB provides amazing performance on commodity hardware, allowing you to support very heavy loads at low cost. The official <a href="https://apple.github.io/foundationdb/performance.html">performance page</a> is giving us some insights:</p>
<p><img src="https://apple.github.io/foundationdb/_images/scaling.png" alt="fdb_perf" /></p>
<blockquote>
<p>Here, a cluster of commodity hardware scales to 8.2 million operations/sec doing a 90% read and 10% write workload with 16 byte keys and values between 8 and 100 bytes. </p>
</blockquote>
<p>You can expect sub-millisecond performance for small reads, without any tuning.</p>
<p>Beside having huge performance, FoundationDB is  easy to <strong>install, grow, manage and fault tolerant</strong>. It has been running in production for years in companies like Apple or Snowflake. Backing FoundationDB up is an unmatched testing system based on a <strong>deterministic simulation engine</strong> that will be described later in the book.</p>
<h2 id="foundationdb-as-a-database-framework"><a class="header" href="#foundationdb-as-a-database-framework">FoundationDB as a database-framework</a></h2>
<p>For developers, FoundationDB can be seen as a <strong>database-framework</strong>: it decouples its data storage technology from its data model, allowing you to write <strong>&quot;layers&quot;</strong>: stateless applications that will use FoundationDB as their storage.</p>
<pre class="mermaid">flowchart TD
    fdb(FoundationDB)
    l1(Layer 1)
    l2(Layer 2)
    ln(Layer N)
    
    l1 -- uses --&gt; fdb
    l2 -- uses --&gt; fdb
    ln -- uses --&gt; fdb
</pre>
<p>Each layer can expose high level data models. They can be developed as libraries or stateless services. And because of FDB performance, they are easy to scale.</p>
<h2 id="a-brief-history-of-foundationdb"><a class="header" href="#a-brief-history-of-foundationdb">A brief history of FoundationDB</a></h2>
<p>FoundationDB started first as a company in 2009. The FoundationDB Alpha program began in January 2012 and concluded on March 4, 2013 with their public Beta release.</p>
<p>Their 1.0 version was released for general availability on August 20, 2013. On March 24, 2015 it was reported that Apple has acquired the company.</p>
<p>On April 19, 2018, Apple open sourced the software, releasing it under the Apache 2.0 license.</p>
<h2 id="who-is-using-foundationdb"><a class="header" href="#who-is-using-foundationdb">Who is using FoundationDB?</a></h2>
<p>Many companies are using FDB, including:</p>
<ul>
<li><strong>Apple iCloud</strong>: they are the largest users. Billions of logical databases are stored in FDB (one per user per application). You will find more details about this on the Record-layer chapter.</li>
<li><strong>Snowflake</strong> is storing all their metadatas in FDB,</li>
<li><strong>VMWare</strong> Tanzu (Formerly Wavefront),</li>
<li><strong>IBM</strong> (Apache CouchDB),</li>
<li><strong>eBay</strong>,</li>
<li><strong>Epic Games</strong>,</li>
<li>...</li>
</ul>
<h2 id="tldr"><a class="header" href="#tldr">TL;DR</a></h2>
<p>FoundationDB is a scalable, robust, distributed key-value store that you can use as a framework to write your own <del>database</del> layer 🤯</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="everything-is-a-key-value"><a class="header" href="#everything-is-a-key-value">Everything is a key-value!</a></h1>
<ul>
<li><a href="meet_fdb/everything_is_kv.html#yugabyte">Yugabyte</a></li>
<li><a href="meet_fdb/everything_is_kv.html#f1-and-spanner-from-google">F1 and Spanner from Google</a></li>
<li><a href="meet_fdb/everything_is_kv.html#tidb--tikv">TiDB / TiKV</a></li>
<li><a href="meet_fdb/everything_is_kv.html#cosmosdb">CosmosDB</a></li>
<li><a href="meet_fdb/everything_is_kv.html#cockroachdb">CockroachDB</a></li>
<li><a href="meet_fdb/everything_is_kv.html#dgraph">Dgraph</a></li>
</ul>
<blockquote>
<p>Ok, so I could store a table-like data in a key-value?</p>
</blockquote>
<p>Yes, this is exactly the idea. It may seem weird at first, but it is a common pattern among new databases. In this section, we will briefly go over some examples.</p>
<h2 id="yugabyte"><a class="header" href="#yugabyte">Yugabyte</a></h2>
<p>From the official <a href="https://docs.yugabyte.com/latest/architecture/layered-architecture/">documentation</a>:</p>
<blockquote>
<p>YugabyteDB architecture follows a layered design. It is comprised of 2 logical layers as shown in the diagram below:</p>
<ul>
<li>
<p>Yugabyte Query Layer</p>
</li>
<li>
<p>DocDB distributed document store</p>
</li>
</ul>
</blockquote>
<p>Information about key encoding format can be found <a href="https://github.com/YugaByte/yugabyte-db/wiki/Low-level-DocDB-key-encoding-format">here</a> and <a href="https://youtu.be/DAFQcYXK2-o?t=1523">here</a>.</p>
<h2 id="f1-and-spanner-from-google"><a class="header" href="#f1-and-spanner-from-google">F1 and Spanner from Google</a></h2>
<p>There is a lot of contents about Google's datastores and their evolution.</p>
<p>At first, they built <a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/36971.pdf">Megastore</a> on top of BigTable:</p>
<blockquote>
<p>In brief, it provides fully serializable ACID semantics over distant replicas with low enough latencies to support interactive applications.</p>
<p>We use Google’s Bigtable for scalable fault-tolerant storage within a single datacenter, allowing us to support arbitrary read and write throughput by spreading operations across multiple rows.</p>
</blockquote>
<p>Then, the first version of <a href="https://www.usenix.org/system/files/conference/osdi12/osdi12-final-16.pdf">Spanner</a> appeared:</p>
<blockquote>
<p>Spanner is a scalable, globally-distributed database designed, built, and deployed at Google.</p>
<p>Spanner has evolved from a Bigtable-like versioned key-value store into a temporal multi-version database. Data is stored in schematized semi-relational tables; data is versioned, and each version is automatically timestamped with its commit time</p>
</blockquote>
<p>Then they added <a href="https://storage.googleapis.com/pub-tools-public-publication-data/pdf/41344.pdf">F1</a> on top of Spanner:</p>
<blockquote>
<p>F1 is a fault-tolerant globally-distributed OLTP and OLAP database built at Google as the new storage system for Google’s AdWords system. It was designed to replace a sharded MySQL implementation that was not able to meet our growing scalability and reliability requirements.</p>
<p>F1 is built on top of Spanner</p>
</blockquote>
<p>And finally, <a href="https://storage.googleapis.com/pub-tools-public-publication-data/pdf/acac3b090a577348a7106d09c051c493298ccb1d.pdf">Spanner itself became an SQL system</a>:</p>
<blockquote>
<p>Google’s Spanner started out as a key-value store offering multi-row transactions, external consistency, and transparent failover across datacenters. Over the past 7 years it has evolved into a relational database system</p>
</blockquote>
<p>It seems it is still organized as layers:</p>
<blockquote>
<p>Like the lower storage and transactional layers, </p>
</blockquote>
<h2 id="tidb--tikv"><a class="header" href="#tidb--tikv">TiDB / TiKV</a></h2>
<p>In the titanium stack, TiKV is the storage layer for <a href="https://www.vldb.org/pvldb/vol13/p3072-huang.pdf">TiDB</a>:</p>
<blockquote>
<p>It has three core components: a distributed storage layer, a Placement Driver(PD), and a computation engine layer.</p>
<p>The distributed storage layer consists of a row store (TiKV) and a columnar store (TiFlash). Logically, the data stored in TiKV is an ordered key-value map. Each tuple is mapped into a key-value pair. The key is composed of its table ID and row ID, and the value is the actual row data, where the table ID and row ID are unique integers </p>
</blockquote>
<p>The table codec can be found <a href="https://github.com/pingcap/tidb/tree/master/tablecodec">here</a>.</p>
<h2 id="cosmosdb"><a class="header" href="#cosmosdb">CosmosDB</a></h2>
<p>More details can be found <a href="http://muratbuffalo.blogspot.com/2018/08/azure-cosmos-db.html">here</a>:</p>
<blockquote>
<p>Cosmos DB supports and projects multiple data models (documents, graphs, key-value, table, etc.) over a minimalist type system and core data model: the atom-record-sequence (ARS) model.</p>
<p>Container and item resources are further projected as reified resource types for a specific type of API interface. For example, while using document-oriented APIs, container and item resources are projected as collection and document resources respectively.</p>
</blockquote>
<p>The automatic indexing strategy is described <a href="http://www.vldb.org/pvldb/vol8/p1668-shukla.pdf">here</a>.</p>
<h2 id="cockroachdb"><a class="header" href="#cockroachdb">CockroachDB</a></h2>
<p>This old <a href="https://www.cockroachlabs.com/blog/sql-in-cockroachdb-mapping-table-data-to-key-value-storage/">blogpost</a> describes the idea:</p>
<blockquote>
<p>The CockroachDB SQL system is built on top of the internal CockroachDB key-value store and leverages the monolithic sorted key-value map to store all of the SQL table data and indexes.</p>
</blockquote>
<p>The encoding notes can be found <a href="https://github.com/cockroachdb/cockroach/blob/master/docs/tech-notes/encoding.md">here</a>.</p>
<h2 id="dgraph"><a class="header" href="#dgraph">Dgraph</a></h2>
<p>From the official <a href="https://dgraph.io/docs/dgraph-overview/#dgraph-architecture">documentation</a>:</p>
<blockquote>
<p>Dgraph is a single layer in your tech stack, but inside the inner workings of a Dgraph database instance, there are three distinct entities:</p>
<ul>
<li>Badger - Dgraph’s custom-built key-value store </li>
<li>Ristretto - Dgraph’s custom-built cache </li>
<li>Dgraph - the methods and algorithms used to parse DQL (and now GraphQL) and act accordingly</li>
</ul>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="mermaid.min.js"></script>
        <script type="text/javascript" src="mermaid-init.js"></script>
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
